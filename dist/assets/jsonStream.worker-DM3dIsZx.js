(function(){"use strict";const S={critical:"critical",high:"high",medium:"medium",low:"low"};function k(e){if(!e)return"unknown";const n=String(e).toLowerCase();return S[n]??"unknown"}function v(e){const n=e.cveId||e.cve||e.id||e.VulnerabilityID;if(!n)return null;const r=e.title||e.summary||e.name||e.packageName||n,o=e.description||e.desc,c=k(e.severity||e.cvssSeverity||e.baseSeverity),u=e.published||e.publishedDate||e.date;let t;const s=e.riskFactors||e.risk||e.tags;Array.isArray(s)?t=s.map(f=>String(f)):s&&typeof s=="object"?t=Object.keys(s):typeof s=="string"&&(t=s.split(/[;,]/).map(f=>f.trim()).filter(Boolean));const a=e.kaiStatus||e.aiStatus||e.status,i=e.cvss||e.cvssScore||e.cvss_v3,m=e.cwe||e.cweIds,g=e.vendor||e.organization,y=e.product||e.package,h=e.source||e.provider;return{id:String(n),title:String(r),description:o,severity:c,published:u,riskFactors:t,kaiStatus:a,cvss:i,cwe:m,vendor:g,product:y,source:h,raw:e}}const l=self;l.onmessage=async e=>{try{if(e.data.type==="fetch")await M(await fetch(e.data.url));else if(e.data.type==="file"){const r=e.data.file.stream();await p(r)}l.postMessage({type:"done"})}catch(n){l.postMessage({type:"error",error:String(n?.message||n)})}};async function M(e){if(!e.ok)throw new Error(`Failed to fetch: ${e.status}`);const n=Number(e.headers.get("content-length")||0);if(l.postMessage({type:"log",message:`Fetch started. status=${e.status} length=${n}`}),e.body&&e.body.getReader){let c=0;const u=e.body.getReader(),t=[];for(;;){const{done:a,value:i}=await u.read();if(a)break;i&&i.length&&(c+=i.length,l.postMessage({type:"progress",bytes:c}),t.push(i))}const s=new ReadableStream({start(a){for(const i of t)a.enqueue(i);a.close()}});l.postMessage({type:"log",message:`Streaming read complete. bytes=${c}`}),await p(s);return}l.postMessage({type:"log",message:"No streaming body; falling back to arrayBuffer()"});const r=await e.arrayBuffer();l.postMessage({type:"progress",bytes:r.byteLength});const o=new ReadableStream({start(c){for(let t=0;t<r.byteLength;t+=1048576)c.enqueue(new Uint8Array(r.slice(t,Math.min(r.byteLength,t+1048576))));c.close()}});await p(o)}async function p(e){const n=new TextDecoder,r=e.getReader();let o="",c=!1,u=!1,t=0,s=0,a=-1;const i=[],m=500,g=()=>{i.length&&l.postMessage({type:"items",items:i.splice(0)})};for(;;){const{done:y,value:h}=await r.read();h&&(o+=n.decode(h,{stream:!0})),y&&(o+=n.decode());for(let f=0;f<o.length;f++){const d=o[f];if(c){if(u){u=!1;continue}if(d==="\\"){u=!0;continue}d==='"'&&(c=!1);continue}if(d==='"'){c=!0;continue}if(d==="["){t++;continue}if(d==="]"){t=Math.max(0,t-1);continue}if(t>0){if(d==="{"){s===0&&(a=f),s++;continue}if(d==="}"){if(s>0&&s--,s===0&&a!==-1){const N=o.slice(a,f+1);a=-1;try{const B=JSON.parse(N),b=v(B);b&&i.push(b),i.length>=m&&g()}catch{}}continue}}}if(a===-1&&o.length>1e6&&(o=o.slice(-5e5)),y)break}g()}})();
